name: GitHub Activity ‚Üí Discord

on:
  push:
    branches: [master, develop]
  pull_request:
    types: [opened, closed, reopened]
  release:
    types: [published]
  watch:
    types: [started]
  fork:

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Send Discord Embed
        run: |
          EVENT="${{ github.event_name }}"
          COLOR=3447003
          TITLE="üì¢ GitHub Activity"

          if [ "$EVENT" = "push" ]; then
            TITLE="üöÄ New Push to ${{ github.ref_name }}"
            DESC="**Commit:** ${{ github.event.head_commit.message }}"
            AUTHOR="${{ github.event.head_commit.author.name }}"
            URL="${{ github.event.compare }}"
            COLOR=65280
          fi

          if [ "$EVENT" = "pull_request" ]; then
            TITLE="üîÅ Pull Request ${{ github.event.action }}"
            DESC="**PR:** #${{ github.event.pull_request.number }} - ${{ github.event.pull_request.title }}"
            AUTHOR="${{ github.event.pull_request.user.login }}"
            URL="${{ github.event.pull_request.html_url }}"
            COLOR=16776960
          fi

          if [ "$EVENT" = "release" ]; then
            TITLE="üè∑ New Release Published"
            DESC="**Tag:** ${{ github.event.release.tag_name }}"
            AUTHOR="${{ github.event.release.author.login }}"
            URL="${{ github.event.release.html_url }}"
            COLOR=10181046
          fi

          if [ "$EVENT" = "watch" ]; then
            TITLE="‚≠ê New Star!"
            DESC="Your repository just got starred!"
            AUTHOR="${{ github.actor }}"
            URL="https://github.com/${{ github.repository }}"
            COLOR=15844367
          fi

          if [ "$EVENT" = "fork" ]; then
            TITLE="üç¥ Repository Forked"
            DESC="Someone forked your repository!"
            AUTHOR="${{ github.actor }}"
            URL="https://github.com/${{ github.repository }}"
            COLOR=15105570
          fi

          curl -H "Content-Type: application/json" \
          -X POST \
          -d "{
            \"username\": \"GitHub Bot\",
            \"embeds\": [{
              \"title\": \"$TITLE\",
              \"description\": \"$DESC\",
              \"color\": $COLOR,
              \"fields\": [{
                \"name\": \"üë§ Actor\",
                \"value\": \"$AUTHOR\",
                \"inline\": true
              }],
              \"url\": \"$URL\",
              \"footer\": {
                \"text\": \"${{ github.repository }}\"
              },
              \"timestamp\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"
            }]
          }" \
          ${{ secrets.DISCORD_WEBHOOK_URL }}
